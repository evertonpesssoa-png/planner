{% extends "base.html" %}
{% block content %}

<div class="calendar-grid">

{% for month in months %}
<section class="month" data-month="{{ month.number }}">
  <h2>{{ month.name }}</h2>

  <div class="week days">
    <span>Seg</span>
    <span>Ter</span>
    <span>Qua</span>
    <span>Qui</span>
    <span>Sex</span>
    <span>S√°b</span>
    <span>Dom</span>
  </div>

  {% for week in month.weeks %}
  <div class="week">
    {% for day in week %}

      {% if day == 0 %}
        <span class="day empty"></span>
      {% else %}

        {# ===============================
           CHAVE PADRONIZADA (YYYY-MM-DD)
           =============================== #}
        {% set key = year ~ "-" ~ "%02d"|format(month.number) ~ "-" ~ "%02d"|format(day) %}

        {# ===============================
           VERIFICA√á√ÉO SEGURA (SEM BUG JINJA)
           =============================== #}
        {% if key in notes %}
          {% set important = notes[key]["important"] %}
        {% else %}
          {% set important = false %}
        {% endif %}

        {# ===============================
           DESTAQUE PARA O DIA DE HOJE
           =============================== #}
        {% set today = namespace(value=false) %}
        {% if day == current_day and month.number == current_month %}
            {% set today.value = true %}
        {% endif %}

        <a href="/day/{{ year }}/{{ month.number }}/{{ day }}"
           class="day{% if important %} important{% endif %}{% if today.value %} today{% endif %}">

          {{ day }}

          {% if important %}
            <span class="badge">üîî</span>
            <span class="star">‚≠ê</span>
          {% endif %}

        </a>

      {% endif %}

    {% endfor %}
  </div>
  {% endfor %}
</section>
{% endfor %}

</div>

{# ===============================
   SCRIPT PARA SCROLL AT√â O M√äS ATUAL
   =============================== #}
<script>
document.addEventListener("DOMContentLoaded", () => {
    const today = new Date();
    const currentMonth = today.getMonth() + 1; // Janeiro = 0

    // Procura o m√™s no calend√°rio
    const monthElement = document.querySelector(`[data-month='${currentMonth}']`);
    if (monthElement) {
        monthElement.scrollIntoView({ behavior: "smooth", block: "start" });
    }
});
</script>

{% endblock %}
